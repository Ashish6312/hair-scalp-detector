{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Hair & Scalp Disease Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    
    <!-- PWA Support -->
    {% include 'pwa_head.html' %}
    
    <style>
      :root {
        --primary-color: #14b8a6;
        --secondary-color-bg: #f3f4f6;
        --accent-color: #10b981;
        --error-color: #ef4444;
        --text-dark: #1f2937;
        --text-light: #6b7280;
        --white-color: #ffffff;
        --border-color: #e5e7eb;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07),
          0 2px 4px -2px rgba(0, 0, 0, 0.07);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -4px rgba(0, 0, 0, 0.1);
        --border-radius: 12px;
        --transition-speed: 0.3s ease;
      }
      [data-theme="dark"] {
        --secondary-color-bg: #111827;
        --text-dark: #f3f4f6;
        --text-light: #9ca3af;
        --white-color: #1f2937;
        --border-color: #374151;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html {
        scroll-behavior: smooth;
      }
      body {
        font-family: "Poppins", sans-serif;
        line-height: 1.7;
        color: var(--text-dark);
        background-color: var(--secondary-color-bg);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      main {
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 100px 1rem 2rem 1rem;
      }
      .navbar {
        position: fixed;
        top: 0;
        width: 100%;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        z-index: 1000;
        padding: 1rem 0;
        border-bottom: 1px solid transparent;
        transition: all var(--transition-speed);
      }

      /* FIXED: Added this rule for the navbar's dark mode background */
      [data-theme="dark"] .navbar {
        background: rgba(31, 41, 55, 0.8);
      }

      .navbar.scrolled {
        padding: 0.75rem 0;
        box-shadow: var(--shadow);
        border-bottom-color: var(--border-color);
      }
      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 1rem;
      }
      .logo {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
        text-decoration: none;
      }
      .nav-links {
        display: none;
        list-style: none;
        gap: 2rem;
        align-items: center;
      }
      @media (min-width: 768px) {
        .nav-links {
          display: flex;
        }
      }
      .nav-links a {
        text-decoration: none;
        color: var(--text-dark);
        font-weight: 500;
      }
      .nav-links li {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .logout-btn {
        background-color: var(--error-color) !important;
        color: white !important;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        transition: all var(--transition-speed);
        font-size: 0.9rem;
        font-weight: 500;
      }
      .logout-btn:hover {
        background-color: #dc2626 !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      }
      .theme-toggle {
        background: var(--white-color);
        border: 1px solid var(--border-color);
        color: var(--text-light);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .upload-card {
        background: var(--white-color);
        border-radius: var(--border-radius);
        padding: 2.5rem;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-lg);
        width: 100%;
        max-width: 800px;
      }
      .upload-card h1 {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
      }
      .upload-card > p {
        color: var(--text-light);
        margin-bottom: 2rem;
      }

      .upload-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      @media (min-width: 768px) {
        .upload-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      #previewContainer {
        position: relative;
        width: 100%;
        padding-top: 100%;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        background-color: var(--secondary-color-bg);
        overflow: hidden;
        cursor: grab;
      }
      #previewContainer:active {
        cursor: grabbing;
      }
      #placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--primary-color);
      }
      #placeholder span {
        font-size: 3rem;
        font-weight: 200;
      }
      #placeholder p {
        margin: 0;
        color: var(--text-light);
      }
      #previewImage {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        transition: transform 0.3s ease-in-out;
      }
      .hidden {
        display: none;
      }

      .image-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        margin-top: 1rem;
      }
      .control-btn {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        color: white;
        font-weight: 500;
        font-size: 0.8rem;
        border: none;
        cursor: pointer;
        transition: all var(--transition-speed);
      }
      .btn-zoom-in {
        background-color: #22c55e;
      }
      .btn-zoom-out {
        background-color: #f59e0b;
      }
      .btn-reset {
        background-color: #3b82f6;
      }
      .btn-remove {
        background-color: var(--error-color);
      }

      .form-inputs {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .input-field {
        width: 100%;
        padding: 0.8rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
        background-color: var(--secondary-color-bg);
        color: var(--text-dark);
      }
      .drop-zone {
        width: 100%;
        padding: 2rem;
        border: 2px dashed var(--primary-color);
        border-radius: var(--border-radius);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color var(--transition-speed);
      }
      .drop-zone:hover {
        background-color: var(--secondary-color-bg);
      }
      .drop-zone span {
        font-size: 2.5rem;
        color: var(--primary-color);
      }
      .drop-zone p {
        margin: 0;
        color: var(--text-light);
      }
      .file-info {
        margin-top: 0.75rem;
        font-size: 0.9rem;
        color: var(--text-light);
        text-align: center;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
        padding: 0.8rem 1.8rem;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: all var(--transition-speed);
        border: none;
        cursor: pointer;
        font-size: 1rem;
      }
      .btn-primary {
        background: var(--accent-color);
        color: white;
        margin-top: 1rem;
      }
      .btn-primary:hover {
        background-color: #059669;
      }
      .btn-primary:disabled {
        background-color: var(--text-light);
        cursor: not-allowed;
      }

      .footer {
        background: var(--text-dark);
        color: #a0aec0;
        padding: 4rem 1rem 2rem;
        margin-top: auto;
      }
      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }
      .footer-section h3 {
        font-size: 1.1rem;
        margin-bottom: 1.2rem;
        color: var(--white-color);
      }
      .footer-section a {
        color: #a0aec0;
        text-decoration: none;
      }
      .footer-bottom {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 2rem;
        text-align: center;
        font-size: 0.9rem;
      }

      /* Footer Dark Mode Improvements */
      [data-theme="dark"] .footer {
        background: #0f172a;
        color: #cbd5e1;
      }

      [data-theme="dark"] .footer-section h3 {
        color: #f1f5f9;
      }

      [data-theme="dark"] .footer-section p,
      [data-theme="dark"] .footer-section a {
        color: #cbd5e1;
      }

      [data-theme="dark"] .footer-bottom {
        border-top-color: rgba(255, 255, 255, 0.15);
        color: #94a3b8;
      }

      /* Session timeout warning */
      .session-warning {
        position: fixed;
        top: 80px;
        right: 20px;
        background: #f59e0b;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: var(--shadow-lg);
        z-index: 1001;
        display: none;
        max-width: 300px;
      }
      .session-warning.show {
        display: block;
      }
      .session-warning .warning-text {
        font-weight: 500;
        margin-bottom: 0.5rem;
      }
      .session-warning .time-left {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .upload-options {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }
      .option-btn {
        flex: 1;
        padding: 1rem;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
        background: var(--secondary-color-bg);
        color: var(--text-dark);
        cursor: pointer;
        transition: all var(--transition-speed);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
      }
      .option-btn:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }
      .option-btn i {
        font-size: 2rem;
      }
    </style>
  </head>
  <body data-theme="dark">
    <nav class="navbar" id="navbar">
      <div class="nav-container">
        <a href="/" class="logo">Hair & Scalp AI</a>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="disease_info">Explore Diseases</a></li>
          <li><a href="appointment">Find a Specialist</a></li>
          <li><a href="/logout" class="logout-btn">Logout</a></li>
        </ul>
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </nav>

    <!-- Session timeout warning -->
    <div id="sessionWarning" class="session-warning">
      <div class="warning-text">Session Expiring Soon!</div>
      <div class="time-left">
        Your session will expire in <span id="timeLeft">5</span> minutes
      </div>
    </div>

    <main>
      <div class="upload-card">
        <form id="uploadForm">
          {% csrf_token %}
          <h1>Hair & Scalp Disease Detection</h1>
          <p>
            Upload a clear scalp image, enter your details, and our AI will
            provide an analysis.
          </p>

          <div class="upload-grid">
            <div>
              <div id="previewContainer">
                <div id="placeholder">
                  <span><i class="fas fa-image"></i></span>
                  <p>Image Preview</p>
                </div>
                <img id="previewImage" src="" alt="Preview" class="hidden" />
              </div>
              <div id="imageControls" class="image-controls hidden">
                <button
                  type="button"
                  onclick="zoomIn()"
                  class="control-btn btn-zoom-in"
                  title="Zoom In"
                >
                  <i class="fas fa-search-plus"></i>
                </button>
                <button
                  type="button"
                  onclick="zoomOut()"
                  class="control-btn btn-zoom-out"
                  title="Zoom Out"
                >
                  <i class="fas fa-search-minus"></i>
                </button>
                <button
                  type="button"
                  onclick="resetZoom()"
                  class="control-btn btn-reset"
                  title="Reset View"
                >
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button
                  type="button"
                  onclick="removeImage()"
                  class="control-btn btn-remove"
                  title="Remove Image"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div>
              <div class="form-inputs">
                <input
                  type="text"
                  id="clientName"
                  placeholder="Full Name"
                  class="input-field"
                  required
                />
                <input
                  type="date"
                  id="clientDOB"
                  class="input-field"
                  required
                />
                <input
                  type="text"
                  id="clientContact"
                  placeholder="Contact Number"
                  class="input-field"
                  required
                />
                <label for="symptomStartDate" style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 0.25rem; display: block;">When did symptoms first appear?</label>
                <input
                  type="date"
                  id="symptomStartDate"
                  class="input-field"
                  required
                  title="Date when disease symptoms first became visible"
                />
              </div>

              <div class="upload-options">
                <a href="/camera-capture" class="option-btn" id="useCameraBtn">
                  <i class="fas fa-camera"></i>
                  <span>Use Camera</span>
                </a>
                <label for="fileInput" class="option-btn">
                  <i class="fas fa-upload"></i>
                  <span>Upload File</span>
                </label>
              </div>
              <input
                type="file"
                id="fileInput"
                name="image"
                accept="image/*"
                class="hidden"
                required
              />

              <div id="fileInfo" class="file-info"></div>

              <button type="button" id="predictBtn" class="btn btn-primary">
                <i class="fas fa-magic"></i> Predict
              </button>
            </div>
          </div>
        </form>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Hair & Scalp AI</h3>
          <p>Advanced AI for hair and scalp disease prediction.</p>
        </div>
        <div class="footer-section">
                <h3>Quick Links</h3>
                <p><a href="/">Home</a></p>
                <p><a href="/#features">Features</a></p>
                <p><a href="/#team">Team</a></p>
                <p><a href="#contact">Contact</a></p>
            </div>
        <div class="footer-section">
          <h3>Services</h3>
          <p><a href="appointment">Find a Specialist</a></p>
          <p><a href="disease_info">Explore Diseases</a></p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Hair & Scalp Disease Prediction. All Rights Reserved.</p>
      </div>
    </footer>

    <script>
      // --- GLOBAL SCRIPTS ---
      const themeToggle = document.getElementById("themeToggle");
      const body = document.body;
      themeToggle.addEventListener("click", () => {
        const currentTheme = body.dataset.theme === "dark" ? "light" : "dark";
        body.dataset.theme = currentTheme;
        themeToggle.querySelector("i").className =
          currentTheme === "dark" ? "fas fa-sun" : "fas fa-moon";
      });

      // --- PAGE-SPECIFIC SCRIPTS ---
      const fileInput = document.getElementById("fileInput");
      const previewImage = document.getElementById("previewImage");
      const previewContainer = document.getElementById("previewContainer");
      const imageControls = document.getElementById("imageControls");
      const fileInfo = document.getElementById("fileInfo");
      const placeholder = document.getElementById("placeholder");

      let currentZoom = 1;
      let isDragging = false;
      let startX,
        startY,
        translateX = 0,
        translateY = 0;

      function handleFile(file) {
        if (file && file.type.startsWith("image/")) {
          // Clear captured image when user uploads new file
          sessionStorage.removeItem('capturedImage');
          sessionStorage.removeItem('capturedImageName');
          sessionStorage.removeItem('captureTimestamp');
          localStorage.removeItem('capturedImage');
          localStorage.removeItem('capturedImageName');
          localStorage.removeItem('captureTimestamp');
          
          const reader = new FileReader();
          reader.onload = (e) => {
            previewImage.src = e.target.result;
            previewImage.classList.remove("hidden");
            placeholder.classList.add("hidden");
            imageControls.classList.remove("hidden");
            fileInfo.textContent = `Selected: ${file.name}`;
            resetZoomAndPosition();
          };
          reader.readAsDataURL(file);
        } else {
          fileInfo.textContent = "Please select a valid image file.";
        }
      }

      fileInput.addEventListener("change", () =>
        handleFile(fileInput.files[0])
      );

      function resetZoomAndPosition() {
        currentZoom = 1;
        translateX = 0;
        translateY = 0;
        updateTransform();
      }
      function zoomIn() {
        currentZoom += 0.1;
        updateTransform();
      }
      function zoomOut() {
        currentZoom = Math.max(0.1, currentZoom - 0.1);
        updateTransform();
      }
      function removeImage() {
        previewImage.src = "";
        previewImage.classList.add("hidden");
        placeholder.classList.remove("hidden");
        imageControls.classList.add("hidden");
        fileInfo.textContent = "";
        fileInput.value = "";
        resetZoomAndPosition();
        
        // Clear captured image from storage when user removes it
        sessionStorage.removeItem('capturedImage');
        sessionStorage.removeItem('capturedImageName');
        sessionStorage.removeItem('captureTimestamp');
        localStorage.removeItem('capturedImage');
        localStorage.removeItem('capturedImageName');
        localStorage.removeItem('captureTimestamp');
        console.log('Captured image cleared from storage');
      }
      function updateTransform() {
        previewImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`;
      }

      previewContainer.addEventListener("mousedown", (e) => {
        if (!previewImage.classList.contains("hidden")) {
          isDragging = true;
          startX = e.clientX - translateX;
          startY = e.clientY - translateY;
        }
      });
      window.addEventListener("mouseup", () => (isDragging = false));
      window.addEventListener("mousemove", (e) => {
        if (isDragging) {
          e.preventDefault();
          translateX = e.clientX - startX;
          translateY = e.clientY - startY;
          updateTransform();
        }
      });

      document
        .getElementById("predictBtn")
        .addEventListener("click", async () => {
          if (!fileInput.files.length) {
            alert("Please select an image first!");
            return;
          }
          const name = document.getElementById("clientName").value.trim();
          const dob = document.getElementById("clientDOB").value.trim();
          const contact = document.getElementById("clientContact").value.trim();
          const symptomStartDate = document.getElementById("symptomStartDate").value.trim();
          if (!name || !dob || !contact || !symptomStartDate) {
            alert("Please fill out all client details including symptom start date!");
            return;
          }

          const file = fileInput.files[0];
          const formData = new FormData();
          formData.append("file", file);
          formData.append("symptom_start_date", symptomStartDate);

          const predictBtn = document.getElementById("predictBtn");
          const originalHTML = predictBtn.innerHTML;
          predictBtn.innerHTML =
            '<span><i class="fas fa-spinner fa-spin"></i> Predicting...</span>';
          predictBtn.disabled = true;

          try {
            const csrfToken = document.querySelector(
              "[name=csrfmiddlewaretoken]"
            ).value;
            const response = await fetch("/predict-api", {
              method: "POST",
              body: formData,
              headers: { "X-CSRFToken": csrfToken },
            });
            const result = await response.json();
            if (result.error) {
              alert(`Error: ${result.error}`);
            } else {
              localStorage.setItem("clientName", name);
              localStorage.setItem("clientDOB", dob);
              localStorage.setItem("clientContact", contact);
              localStorage.setItem("symptomStartDate", symptomStartDate);
              localStorage.setItem("prediction", JSON.stringify(result));
              localStorage.setItem("uploadedImage", previewImage.src);
              window.location.href = "/result";
            }
          } catch (error) {
            alert(`An error occurred: ${error.message}`);
          } finally {
            predictBtn.innerHTML = originalHTML;
            predictBtn.disabled = false;
          }
        });

      // Session timeout management
      let sessionTimeout = null;
      let warningShown = false;

      function startSessionTimer() {
        // Clear any existing timer
        if (sessionTimeout) {
          clearTimeout(sessionTimeout);
        }

        // Set timer for 25 minutes (5 minutes before 30-minute timeout)
        sessionTimeout = setTimeout(() => {
          showSessionWarning();
        }, 25 * 60 * 1000); // 25 minutes in milliseconds
      }

      function showSessionWarning() {
        if (warningShown) return;

        warningShown = true;
        const warning = document.getElementById("sessionWarning");
        const timeLeft = document.getElementById("timeLeft");

        warning.classList.add("show");

        // Countdown from 5 minutes
        let minutes = 5;
        const countdown = setInterval(() => {
          timeLeft.textContent = minutes;
          minutes--;

          if (minutes < 0) {
            clearInterval(countdown);
            // Redirect to login after 5 minutes warning
            window.location.href = "/login";
          }
        }, 60000); // Update every minute
      }

      function resetSessionTimer() {
        warningShown = false;
        const warning = document.getElementById("sessionWarning");
        warning.classList.remove("show");
        startSessionTimer();
      }

      // Start timer when page loads
      startSessionTimer();

      // Set max date for symptom start date to today
      document.getElementById('symptomStartDate').max = new Date().toISOString().split('T')[0];

      // Reset timer on user activity
      ["click", "keypress", "scroll", "mousemove"].forEach((event) => {
        document.addEventListener(event, resetSessionTimer, true);
      });

      // Clear storage when clicking "Use Camera" button
      const useCameraBtn = document.getElementById('useCameraBtn');
      if (useCameraBtn) {
        useCameraBtn.addEventListener('click', (e) => {
          // Clear previous captured image
          sessionStorage.removeItem('capturedImage');
          sessionStorage.removeItem('capturedImageName');
          sessionStorage.removeItem('captureTimestamp');
          localStorage.removeItem('capturedImage');
          localStorage.removeItem('capturedImageName');
          localStorage.removeItem('captureTimestamp');
          console.log('Cleared previous captured image before opening camera');
        });
      }

      // Check if there's a captured image from camera page
      window.addEventListener('load', () => {
        console.log('=== PREDICT PAGE LOADED ===');
        console.log('Checking for captured image...');
        
        // Check sessionStorage first, then localStorage
        let capturedImage = sessionStorage.getItem('capturedImage');
        let capturedImageName = sessionStorage.getItem('capturedImageName');
        let timestamp = sessionStorage.getItem('captureTimestamp');
        
        console.log('SessionStorage check:', {
          hasImage: !!capturedImage,
          imageSize: capturedImage ? capturedImage.length : 0,
          timestamp: timestamp
        });
        
        if (!capturedImage) {
          console.log('Not in sessionStorage, checking localStorage...');
          capturedImage = localStorage.getItem('capturedImage');
          capturedImageName = localStorage.getItem('capturedImageName');
          timestamp = localStorage.getItem('captureTimestamp');
          
          console.log('LocalStorage check:', {
            hasImage: !!capturedImage,
            imageSize: capturedImage ? capturedImage.length : 0,
            timestamp: timestamp
          });
        }
        
        console.log('Final result - Captured image exists:', !!capturedImage);
        
        if (capturedImage) {
          console.log('Loading captured image...');
          
          try {
            // Convert base64 to blob
            fetch(capturedImage)
              .then(res => res.blob())
              .then(blob => {
                console.log('Blob created:', blob.size, 'bytes');
                
                const file = new File([blob], capturedImageName || 'camera-capture.jpg', { type: 'image/jpeg' });
                console.log('File created:', file.name, file.size);
                
                // Create a DataTransfer to set the file input
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;
                
                console.log('File input set:', fileInput.files.length, 'files');

                // Show preview
                previewImage.src = capturedImage;
                previewImage.classList.remove('hidden');
                placeholder.classList.add('hidden');
                imageControls.classList.remove('hidden');
                fileInfo.textContent = 'âœ“ Captured from camera';
                resetZoomAndPosition();

                console.log('Image loaded successfully!');

                // DON'T clear storage - keep it until page refresh
                // This allows the image to persist even if user navigates away
                console.log('=== IMAGE LOADED SUCCESSFULLY ===');
                console.log('Storage kept for persistence');
              })
              .catch(error => {
                console.error('Error loading image:', error);
                alert('Error loading captured image. Please try again.');
                sessionStorage.removeItem('capturedImage');
                sessionStorage.removeItem('capturedImageName');
                localStorage.removeItem('capturedImage');
                localStorage.removeItem('capturedImageName');
              });
          } catch (error) {
            console.error('Error processing image:', error);
            alert('Error processing captured image. Please try again.');
            sessionStorage.removeItem('capturedImage');
            sessionStorage.removeItem('capturedImageName');
            localStorage.removeItem('capturedImage');
            localStorage.removeItem('capturedImageName');
          }
        } else {
          console.log('No captured image found in sessionStorage');
        }
      });
    </script>
    <script> window.chtlConfig = { chatbotId: "8383945963" } </script>
<script async data-id="8383945963" id="chtl-script" type="text/javascript" src="https://chatling.ai/js/embed.js"></script>
    
    <!-- PWA Install Banner -->
    {% include 'pwa_banner.html' %}
  </body>
</html>
