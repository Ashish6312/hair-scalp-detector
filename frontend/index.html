<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hair & Scalp Disease Detection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #previewContainer {
      overflow: hidden;
      cursor: grab;
    }
    #previewContainer:active {
      cursor: grabbing;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-100 p-6">

  <!-- Upload Card -->
  <div class="w-full max-w-3xl bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
    <h1 class="text-2xl font-bold text-gray-800 mb-2">Hair & Scalp Disease Detection</h1>
    <p class="text-gray-500 mb-6">Upload a clear scalp image, preview it with zoom, then get a prediction.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <!-- Preview Box -->
      <div class="flex flex-col items-center">
        <div id="previewContainer" 
             class="relative w-72 h-72 border-2 border-indigo-400 rounded-lg bg-indigo-50 shadow-inner flex items-center justify-center">
          
          <!-- Placeholder -->
          <div id="placeholder" class="flex flex-col items-center text-indigo-500">
            <span class="text-4xl">Ôºã</span>
            <p class="text-sm font-medium mt-1">No image selected</p>
            <p class="text-xs text-indigo-400">Choose or drag an image to preview</p>
          </div>

          <!-- Image -->
          <img id="previewImage" src="" alt="Preview"
               class="hidden absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300 ease-in-out"/>
        </div>

        <!-- Controls -->
        <div id="imageControls" class="hidden flex flex-wrap gap-3 justify-center mt-4">
          <button onclick="zoomIn()" 
                  class="px-4 py-2 rounded-lg bg-green-500 text-white font-medium shadow hover:bg-green-600 transition">
            üîç Zoom In
          </button>
          <button onclick="zoomOut()" 
                  class="px-4 py-2 rounded-lg bg-yellow-500 text-white font-medium shadow hover:bg-yellow-600 transition">
            üîç Zoom Out
          </button>
          <button onclick="resetZoom()" 
                  class="px-4 py-2 rounded-lg bg-blue-500 text-white font-medium shadow hover:bg-blue-600 transition">
            ‚ôª Reset View
          </button>
          <button onclick="removeImage()" 
                  class="px-4 py-2 rounded-lg bg-red-500 text-white font-medium shadow hover:bg-red-600 transition">
            ‚ùå Remove
          </button>
        </div>
      </div>

      <!-- Upload & Predict -->
      <div class="flex flex-col items-center justify-center w-full">
        
        <!-- ‚úÖ Client Details Form -->
        <div class="w-full space-y-3 mb-6">
          <input type="text" id="clientName" placeholder="Full Name"
                 class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none"/>
          <input type="date" id="clientDOB"
                 class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none"/>
          <input type="text" id="clientContact" placeholder="Contact Number"
                 class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none"/>
        </div>

        <!-- Upload -->
        <label for="fileInput" 
               class="w-full h-40 border-2 border-dashed border-indigo-400 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:bg-indigo-50 transition">
          <span class="text-4xl text-indigo-500">Ôºã</span>
          <p class="text-gray-500">Click to upload or drag & drop</p>
          <p class="text-xs text-gray-400">PNG, JPG, JPEG ‚Äî up to ~10MB</p>
        </label>
        <input type="file" id="fileInput" accept="image/*" class="hidden">
        
        <div id="fileInfo" class="mt-3 text-sm text-gray-600"></div>

        <button id="predictBtn"
          class="mt-5 w-full px-6 py-3 rounded-lg bg-indigo-600 text-white font-semibold shadow hover:bg-indigo-700 transition">
          üîÆ Predict
        </button>
      </div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const previewImage = document.getElementById('previewImage');
    const previewContainer = document.getElementById('previewContainer');
    const imageControls = document.getElementById('imageControls');
    const fileInfo = document.getElementById('fileInfo');
    const placeholder = document.getElementById('placeholder');

    let currentZoom = 1;
    let fitScale = 1; 
    let isDragging = false;
    let startX, startY, translateX = 0, translateY = 0;

    // File selection
    fileInput.addEventListener('change', function() {
      if (fileInput.files.length) {
        const file = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImage.onload = () => {
            const container = previewContainer.getBoundingClientRect();
            const scaleX = container.width / previewImage.naturalWidth;
            const scaleY = container.height / previewImage.naturalHeight;
            fitScale = Math.min(scaleX, scaleY); 
            resetZoom(); 
          };
          previewImage.src = e.target.result;
          previewImage.classList.remove('hidden');
          placeholder.classList.add('hidden');
          imageControls.classList.remove('hidden');
          fileInfo.textContent = `Selected: ${file.name} (${Math.round(file.size/1024)} KB)`;
        };
        reader.readAsDataURL(file);
      }
    });

    // Reset to fit inside box
    function resetZoom() {
      currentZoom = fitScale;
      translateX = 0;
      translateY = 0;
      updateTransform();
    }

    // Zoom functions
    function zoomIn() {
      currentZoom += 0.2;
      updateTransform();
    }
    function zoomOut() {
      currentZoom = Math.max(fitScale, currentZoom - 0.2);
      updateTransform();
    }

    function removeImage() {
      previewImage.src = "";
      previewImage.classList.add("hidden");
      placeholder.classList.remove("hidden");
      imageControls.classList.add("hidden");
      fileInfo.textContent = "";
      fileInput.value = "";
    }

    function updateTransform() {
      previewImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentZoom})`;
    }

    // Dragging inside preview
    previewContainer.addEventListener('mousedown', (e) => {
      if (!previewImage.classList.contains('hidden')) {
        isDragging = true;
        startX = e.clientX - translateX;
        startY = e.clientY - translateY;
      }
    });
    previewContainer.addEventListener('mouseup', () => isDragging = false);
    previewContainer.addEventListener('mouseleave', () => isDragging = false);
    previewContainer.addEventListener('mousemove', (e) => {
      if (isDragging) {
        translateX = e.clientX - startX;
        translateY = e.clientY - startY;
        updateTransform();
      }
    });

    // ‚úÖ Predict button: Save file + client details in localStorage, redirect
    document.getElementById('predictBtn').addEventListener('click', () => {
      if (!fileInput.files.length) {
        alert("Please select an image first!");
        return;
      }
      
      const name = document.getElementById('clientName').value.trim();
      const dob = document.getElementById('clientDOB').value.trim();
      const contact = document.getElementById('clientContact').value.trim();

      if (!name || !dob || !contact) {
        alert("Please fill out all client details!");
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        localStorage.setItem('uploadedImage', e.target.result);
        localStorage.setItem('uploadedFileName', file.name);

        // Save client details
        localStorage.setItem('clientName', name);
        localStorage.setItem('clientDOB', dob);
        localStorage.setItem('clientContact', contact);

        window.location.href = 'result.html';
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
